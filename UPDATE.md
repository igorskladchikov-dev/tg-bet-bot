# Как обновить бота, если он уже работает

Если бот уже запущен на Railway (или другом сервисе), вот как применить последние изменения:

---

## Способ 1: Автоматическое обновление через GitHub (рекомендуется)

Если ты уже подключил репозиторий GitHub к Railway, обновление происходит автоматически:

1. **В Cursor (на своём компьютере):**
   - Убедись, что все изменения сохранены.
   - Открой терминал в Cursor (Ctrl+`).
   - Выполни команды:
     ```bash
     git add .
     git commit -m "Update: add chat isolation and /active command"
     git push
     ```

2. **Railway автоматически:**
   - Обнаружит новый коммит в GitHub.
   - Пересоберёт и перезапустит бота с новым кодом.
   - Обычно это занимает 1–3 минуты.

3. **Проверь статус:**
   - Зайди на railway.app → свой проект → вкладка **Deployments**.
   - Должен появиться новый деплой со статусом **Success** (зелёный).
   - Если статус **Failed** (красный) — нажми на него и посмотри логи ошибок.

---

## Способ 2: Ручной деплой через Railway Dashboard

Если автоматическое обновление не сработало:

1. Зайди на **railway.app** → свой проект.
2. Нажми на сервис (карточку с ботом).
3. Во вкладке **Settings** → **Deploy** нажми кнопку **Redeploy** или **Deploy Now**.
4. Дождись завершения (статус станет зелёным).

---

## Способ 3: Если бот запущен локально (на твоём ПК)

1. Останови бота: в терминале нажми **Ctrl+C**.
2. Обнови код (если используешь Git: `git pull`, или просто скопируй новые файлы).
3. Запусти снова: `python bot.py`.

---

## Что изменилось в последнем обновлении

- ✅ **Изоляция по чатам**: балансы и ставки теперь отдельные для каждого чата.
- ✅ **Команда `/active`**: показывает все нерассчитанные ставки в чате с авторами.

---

## Важно: данные при обновлении

- **Если бот уже работал** и у тебя есть данные в `data/users.json` и `data/bets.json`:
  - Старые данные могут не работать с новой структурой (теперь всё хранится по `chat_id`).
  - **Рекомендация**: после обновления попроси всех в чате написать `/start` заново — это создаст новые записи с правильной структурой.
  - Старые данные останутся в файлах, но не будут использоваться.

- **Если бот только что запущен** — всё будет работать сразу, структура данных правильная.

---

## Проверка, что всё работает

После обновления проверь в чате:

1. `/start` — должен ответить приветствием.
2. `/active` — должен показать список активных ставок (или сообщение, что их нет).
3. `/top` — должен показать таблицу участников текущего чата.

Если что-то не работает — посмотри логи в Railway (вкладка **Deployments** → выбери последний деплой → **View Logs**).
